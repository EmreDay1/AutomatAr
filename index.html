<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutomatAR - Interactive Mechanical Engineering Learning</title>
  <meta name="description" content="Explore mechanical engineering concepts through augmented reality with AutomatAR's interactive learning platform.">
  
  <!-- External Libraries -->
  <script src="libs/Three.js"></script>
  <script src="libs/STLLoader.js"></script>
  <script src="src/svd.js"></script>
  <script src="src/posit1.js"></script>
  <script src="src/cv.js"></script>
  <script src="src/aruco.js"></script>
  <script src="src/atf.js"></script>
  <script src="src/multiS.js"></script>
  <script src="src/optic.js"></script>

  <!-- Stylesheets -->
  <link rel="stylesheet" href="styles.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">

 <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #FF8C00 0%, #FF7F00 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Header */
    .ai-header {
      background: rgba(255, 255, 255, 0.1);
      padding: 1.5rem 2rem;
      text-align: center;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .ai-close-button {
      position: absolute;
      top: 1.5rem;
      left: 2rem;
      background: #ffffff;
      color: #FF8C00;
      border: 2px solid #ffffff;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s ease;
      text-transform: uppercase;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
      font-size: 0.9rem;
    }

    .ai-close-button:hover {
      background: #FF8C00;
      color: #ffffff;
      transform: translateY(-1px);
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    }

    .ai-header-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
    }

    .ai-header-subtitle {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 500;
    }

    /* Main Container */
    .ai-main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      scroll-snap-type: y mandatory;
      height: calc(100vh - 140px);
      overflow-y: auto;
    }

    /* Card Container */
    .ai-card-container {
      margin-bottom: 2rem;
      scroll-snap-align: start;
      opacity: 0;
      transform: translateY(60px) scale(0.95);
      transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .ai-card-container.animate-in {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .ai-card-container:nth-child(2) {
      transition-delay: 0.2s;
    }

    .ai-card-container:nth-child(3) {
      transition-delay: 0.4s;
    }

    /* Horizontal Card Design */

/* Horizontal Card Design */
.ai-horizontal-card {
  background: linear-gradient(145deg, 
    rgba(230, 245, 255, 0.95) 0%, 
    rgba(210, 235, 255, 0.9) 100%);
  border-radius: 20px;
  box-shadow: 
    0 20px 60px rgba(0, 0, 0, 0.05),
    0 8px 24px rgba(180, 220, 255, 0.15),
    inset 0 2px 0 rgba(255, 255, 255, 0.8);
  display: flex;
  min-height: 200px;
  position: relative;
  overflow: hidden;
  border: 3px solid rgba(255, 255, 255, 0.5);
  backdrop-filter: blur(10px);
  transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
}

.ai-horizontal-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 
    0 30px 80px rgba(0, 0, 0, 0.1),
    0 12px 36px rgba(180, 220, 255, 0.25),
    inset 0 2px 0 rgba(255, 255, 255, 0.9);
  border-color: rgba(255, 255, 255, 0.7);
}

/* Left Side - Dropdown Area */
.card-left-side {
  flex: 1;
  padding: 2rem;
  display: flex;
  flex-direction: column;
  justify-content: center;
  position: relative;
  background: linear-gradient(135deg, 
    rgba(210, 235, 255, 0.2) 0%, 
    rgba(190, 225, 250, 0.3) 100%);
}

.card-title {
  font-size: 2rem;
  font-weight: 700;
  color: #4BA3C7;
  margin-bottom: 0.5rem;
  text-shadow: 0 2px 4px rgba(75, 163, 199, 0.3);
}

/* Right Side - Image Area */
.card-right-side {
  flex: 1.5;
  background: linear-gradient(135deg, #e6f5ff 0%, #d0ebff 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}
    .card-subtitle {
      font-size: 1.1rem;
      color: #666;
      margin-bottom: 2rem;
      font-weight: 500;
    }

    /* Custom Dropdown */
    .custom-dropdown {
      position: relative;
      width: 100%;
      max-width: 300px;
    }

    .dropdown-trigger {
      width: 100%;
      background: linear-gradient(145deg, #ffffff, #f8f9fa);
      border: 2px solid #FF8C00;
      border-radius: 12px;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      color: #FF8C00;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 
        0 4px 12px rgba(255, 140, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      transition: all 0.3s ease;
    }

    .dropdown-trigger:hover {
      background: linear-gradient(145deg, #f8f9fa, #e9ecef);
      border-color: #FF7F00;
      box-shadow: 
        0 6px 18px rgba(255, 140, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.9);
    }

    .dropdown-trigger.active {
      border-color: #FF6600;
      background: linear-gradient(145deg, #fff3e0, #ffe0b2);
    }

    .dropdown-arrow {
      font-size: 0.8rem;
      transition: transform 0.3s ease;
    }

    .dropdown-trigger.active .dropdown-arrow {
      transform: rotate(180deg);
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #ffffff;
      border: 2px solid #FF8C00;
      border-radius: 12px;
      box-shadow: 0 12px 36px rgba(0, 0, 0, 0.15);
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      margin-top:8px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-20px);
      transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .dropdown-menu.open {
      opacity: 1;
      visibility: visible;
      transform: translateY(8px);    /* small gap under the trigger */
    }

    .dropdown-option {
      padding: 1rem 1.5rem;
      font-size: 0.95rem;
      color: #333;
      cursor: pointer;
      border-bottom: 1px solid rgba(255, 140, 0, 0.1);
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .dropdown-option:last-child {
      border-bottom: none;
    }

    .dropdown-option:hover {
      background: linear-gradient(135deg, 
        rgba(255, 140, 0, 0.1) 0%, 
        rgba(255, 165, 0, 0.05) 100%);
      color: #FF8C00;
      font-weight: 600;
    }

    .dropdown-option.selected {
      background: linear-gradient(135deg, 
        rgba(255, 140, 0, 0.2) 0%, 
        rgba(255, 165, 0, 0.1) 100%);
      color: #FF6600;
      font-weight: 600;
    }

    /* Right Side - Image Area */
    .card-right-side {
      flex: 1.5;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .card-image-container {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    }

    .card-image {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
      opacity: 0;
      transform: scale(0.8);
    }

    .card-image.loaded {
      opacity: 1;
      transform: scale(1);
    }

    .card-image:hover {
      transform: scale(1.05);
      box-shadow: 0 12px 36px rgba(0, 0, 0, 0.15);
    }

    .image-placeholder {
      width: 150px;
      height: 150px;
      background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: #adb5bd;
      border: 3px dashed #ced4da;
      transition: all 0.3s ease;
    }

    .image-placeholder:hover {
      background: linear-gradient(135deg, #dee2e6 0%, #ced4da 100%);
      color: #868e96;
    }

    /* Help Button */
    .help-button {
      position: absolute;
      bottom: 1rem;
      left: 1rem;
      background: #FF8C00;
      color: #ffffff;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(255, 140, 0, 0.3);
      transition: all 0.3s ease;
      z-index: 10;
    }

    .help-button:hover {
      background: #FF7F00;
      transform: scale(1.1);
      box-shadow: 0 6px 18px rgba(255, 140, 0, 0.4);
    }

    /* Scenario Button */
    .scenario-button-container {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 200;
    }

    .scenario-button {
      width: 100%;
      height: 60px;
      background: linear-gradient(135deg, #FF8C00 0%, #FF7F00 100%);
      border: none;
      color: #ffffff;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .scenario-button:hover {
      background: linear-gradient(135deg, #FF7F00 0%, #FF6600 100%);
      box-shadow: 0 -6px 30px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }

    /* Scenario Popup */
    .scenario-popup {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 300;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .scenario-popup.open {
      opacity: 1;
      visibility: visible;
    }

    .scenario-content {
      background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 20px;
      padding: 3rem;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      position: relative;
      transform: scale(0.8) translateY(40px);
      transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .scenario-popup.open .scenario-content {
      transform: scale(1) translateY(0);
    }

    .scenario-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: #FF8C00;
      color: #ffffff;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .scenario-close:hover {
      background: #FF7F00;
      transform: scale(1.1);
    }

    .scenario-title {
      font-size: 2rem;
      font-weight: 700;
      color: #FF8C00;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .scenario-text {
      font-size: 1.1rem;
      line-height: 1.6;
      color: #333;
      margin-bottom: 1.5rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .ai-horizontal-card {
        flex-direction: column;
        min-height: auto;
      }

      .card-left-side,
      .card-right-side {
        flex: none;
      }

      .card-left-side {
        padding: 1.5rem;
      }

      .card-right-side {
        min-height: 200px;
      }

      .ai-main-container {
        padding: 1rem;
        height: calc(100vh - 180px);
        margin-bottom: 60px;
      }

      .scenario-content {
        margin: 1rem;
        padding: 2rem;
      }
    }

    /* Scrollbar Styling */
    .ai-main-container::-webkit-scrollbar {
      width: 8px;
    }

    .ai-main-container::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }

    .ai-main-container::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }

    .ai-main-container::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    /* Animation Classes */
    .fade-in {
      animation: fadeIn 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .scale-in {
      animation: scaleIn 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Loading States */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid #FF8C00;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

        /* 1. Let dropdowns escape their card/container */
    .ai-card-container,
    .ai-horizontal-card {
      overflow: visible;
    }

    /* 2. Make sure the dropdown itself floats on top */
    .custom-dropdown {
      position: relative;  /* ensure child z-index is relative to this */
      z-index: 1000;       /* a base stacking context */
    }

    .dropdown-menu {
      z-index: 1001;       /* just above its parent; adjust upward if needed */
    }

    /* If there are any other higher-z elements (like modals),
      you can go even higher: */
    .scenario-popup,
    #aiScreen .dropdown-menu {
      z-index: 9999 !important;
    }
    /* 1) bump the open card above its siblings */
    .ai-card-container.dropdown-open {
      position: relative;
      z-index: 1002;
    }

    /* 2) equalize heights across all horizontal cards */
    .ai-horizontal-card {
      min-height: 260px;    /* whatever matches your Kit cards’ height */
      /* if you need more fine-tuning, adjust this value */
    }

    /* 3) (optional) ensure the left and right sides stretch */
    .ai-horizontal-card {
      display: flex;
      align-items: stretch;
    }
    .card-left-side,
    .card-right-side {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* 1) let dropdowns escape their card */
    .ai-card-container,
    .ai-horizontal-card {
      overflow: visible;
    }

    /* 2) the menu itself */
    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0; right: 0;
      background: #fff;
      border: 2px solid #FF8C00;
      border-radius: 12px;
      box-shadow: 0 12px 36px rgba(0,0,0,0.15);
      max-height: 240px;        /* tweak as you like */
      overflow-y: auto;
      margin-top: 8px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-20px);
      transition: all 0.3s cubic-bezier(0.23,1,0.32,1);
      z-index: 1001;
    }

    .dropdown-menu.open {
      opacity: 1;
      visibility: visible;
      transform: translateY(8px);  /* sits 8px below the trigger */
    }
  </style>
</head>
<script>
  function updateSnapOffsets() {
    const header = document.querySelector('.header-bar');
    const home   = document.getElementById('homeScreen');
    if (!header || !home) return;
    const h = header.getBoundingClientRect().height;
    // 1) tell the container to inset its snap zone
    home.style.scrollPaddingTop = h + 'px';
    // 2) shift each section down by the same amount
    document.querySelectorAll('.kit-section').forEach(sec => {
      sec.style.scrollMarginTop = h + 'px';
    });
  }

  window.addEventListener('load',  updateSnapOffsets);
  window.addEventListener('resize', updateSnapOffsets);
  // if your header may change height on scroll (unlikely)
  // you can also throttle+call it on scroll:
  // window.addEventListener('scroll', updateSnapOffsets);
</script>

<body>
  <!-- Parallax Background -->
  <div class="parallax-bg"></div>

  <!-- Header -->
  <header class="header-bar" id="mainHeader">
    <div class="header-content">
      <div></div>
      <h1>AutomatAR</h1>
      <nav class="header-buttons" role="navigation" aria-label="Main navigation">
        <button class="header-button" id="createBtn" aria-label="Create new content">Create</button>
        <button class="header-button" id="manualsBtn" aria-label="View instruction manuals">Manuals</button>
        <!-- new: links via fragment to the AR section -->
        <a href="#arScreen" class="header-ar-button" aria-label="Open augmented reality experience" id="openARBtn">
          Open AR
        </a>
        <button class="header-button" id="modelsBtn" aria-label="Download 3D models">Models</button>
        <button class="header-button" id="aiBtn" aria-label="AI learning assistant">AI</button>
      </nav>
    </div>
  </header>

  <!-- Home Screen -->
  <main id="homeScreen">
    <!-- Intro Section -->
    <section class="intro-section" role="banner">
      <div class="container">
        <h2>Welcome to AutomatAR</h2>
        <p>Explore mechanical engineering concepts through augmented reality. Point your camera at kit markers to see interactive 3D demonstrations of gears, cams, cranks, and other mechanical systems.</p>
      </div>
    </section>

    <!-- Cam-A Kit Section -->
    <section class="kit-section" aria-labelledby="cam-a-title">
      <div class="kit-content">
        <div class="kit-text pre-assembly">
          <h3 id="cam-a-title">Cam-A: Learn the details of rotational motion</h3>
          <p>Demonstrates how cams convert rotational motion into linear oscillatory motion using contoured surfaces to drive followers in precise, complex patterns.</p>
        </div>
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(0)" role="button" tabindex="0" aria-label="View Cam-A kit details">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit1.mp4" type="video/mp4">
            <div class="placeholder-img">Cam-A Kit Video</div>
          </video>
        </div>
      </div>
    </section>

    <!-- Cam-C Kit Section -->
    <section class="kit-section" aria-labelledby="cam-c-title">
      <div class="kit-content reverse">
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(1)" role="button" tabindex="0" aria-label="View Cam-C kit details">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit2.mp4" type="video/mp4">
            <div class="placeholder-img">Cam-C Kit Video</div>
          </video>
        </div>
        <div class="kit-text pre-assembly">
          <h3 id="cam-c-title">Cam-C: Get to know more about intermittent motion</h3>
          <p>Shows how a Geneva wheel mechanism creates precise, timed intermittent motion from continuous rotational input using pins and slots.</p>
        </div>
      </div>
    </section>

    <!-- Crank Kit Section -->
    <section class="kit-section" aria-labelledby="crank-title">
      <div class="kit-content">
        <div class="kit-text pre-assembly">
          <h3 id="crank-title">Crank: Understanding reciprocating motion</h3>
          <p>Illustrates how a rotating crank arm converts rotational motion into linear back-and-forth movement through connecting rods.</p>
        </div>
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(2)" role="button" tabindex="0" aria-label="View Crank kit details">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit3.mp4" type="video/mp4">
            <div class="placeholder-img">Crank Kit Video</div>
          </video>
        </div>
      </div>
    </section>

    <!-- Gear-A Kit Section -->
    <section class="kit-section" aria-labelledby="gear-a-title">
      <div class="kit-content reverse">
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(3)" role="button" tabindex="0" aria-label="View Gear-A kit details">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit4.mp4" type="video/mp4">
            <div class="placeholder-img">Gear-A Kit Video</div>
          </video>
        </div>
        <div class="kit-text pre-assembly">
          <h3 id="gear-a-title">Gear-A: Exploring perpendicular power transmission</h3>
          <p>Demonstrates how bevel gears with cone-shaped teeth transfer rotational motion between perpendicular shafts at 90-degree angles.</p>
        </div>
      </div>
    </section>

    <!-- Gear-B Kit Section -->
    <section class="kit-section" aria-labelledby="gear-b-title">
      <div class="kit-content">
        <div class="kit-text pre-assembly">
          <h3 id="gear-b-title">Gear-B: Variable speed and torque systems</h3>
          <p>Shows how gear alignment and shape create variable speed and torque output from constant input through dynamic load distribution.</p>
        </div>
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(4)" role="button" tabindex="0" aria-label="View Gear-B kit details">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit5.mp4" type="video/mp4">
            <div class="placeholder-img">Gear-B Kit Video</div>
          </video>
        </div>
      </div>
    </section>

    <!-- Gear-C Kit Section -->
    <section class="kit-section" aria-labelledby="gear-c-title">
      <div class="kit-content reverse">
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(5)" role="button" tabindex="0" aria-label="View Gear-C kit details">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit6.mp4" type="video/mp4">
            <div class="placeholder-img">Gear-C Kit Video</div>
          </video>
        </div>
        <div class="kit-text pre-assembly">
          <h3 id="gear-c-title">Gear-C: Mastering worm gear systems</h3>
          <p>Gear-C is a worm gear system that converts rotational motion while significantly reducing speed & increasing torque. A screw-like worm drives a worm wheel, transferring motion at 90°. This design offers high torque output & a self-locking feature, so it can't be back-driven. Used in elevators, conveyors, tuning mechanisms—anywhere controlled motion & torque multiplication are vital.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Kit Detail Screen -->
  <section id="kitDetailScreen" role="main" aria-labelledby="kit-detail-title">
    <div class="container">
      <div class="kit-detail">
        <div class="kit-detail-image">
          <video class="kit-detail-video" autoplay muted loop playsinline id="kitDetailVideo">
            <source src="images/camani.mp4" type="video/mp4">
            <div class="placeholder-img" id="kitDetailImg">Kit Video</div>
          </video>
        </div>
        <div class="kit-detail-text">
          <h2 id="kit-detail-title">Kit Name</h2>
          <p id="kitDetailDesc">Kit description will appear here.</p>
          <button class="back-button" id="kitBackHomeBtn" aria-label="Return to home screen">Back to Home</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Manuals Screen -->
  <section id="manualsScreen" class="modal-screen" role="main" aria-labelledby="manuals-title">
    <div class="modal-header">
      <button class="modal-close-button" id="closeManualsBtn" aria-label="Close manuals screen">← Back</button>
      <div class="modal-title" id="manuals-title">Instruction Manuals</div>
      <div class="modal-subtitle">Download comprehensive guides for each mechanical kit</div>
    </div>
    <div class="modal-content">
      <div class="content-grid">
        <div class="content-card">
          <h3>Cam-A Manual</h3>
          <p>Complete assembly instructions and theory guide for the Cam-A rotational motion kit. Includes part diagrams, assembly steps, and engineering principles.</p>
          <a
            class="download-button"
            href="manuals/1.pdf"
            download="Cam-A_Rotational_Motion_Manual.pdf"
            aria-label="Download Cam-A manual">
            Download Manual
          </a>
        </div>
        <div class="content-card">
          <h3>Cam-C Manual</h3>
          <p>Geneva wheel mechanism guide covering intermittent motion principles, assembly procedures, and practical applications in machinery.</p>
          <a
            class="download-button"
            href="manuals/2.pdf"
            download="Cam-C_Intermittent_Motion_Manual.pdf"
            aria-label="Download Cam-C manual">
            Download Manual
          </a>
        </div>
        <div class="content-card">
          <h3>Crank Manual</h3>
          <p>Reciprocating motion system manual with detailed explanations of crank mechanisms, connecting rods, and motion conversion principles.</p>
          <a
            class="download-button"
            href="manuals/3.pdf"
            download="Crank_Reciprocating_Motion_Manual.pdf"
            aria-label="Download Crank manual">
            Download Manual
          </a>
        </div>
        <div class="content-card">
          <h3>Gear-A Manual</h3>
          <p>Bevel gear system guide explaining perpendicular power transmission, gear ratios, and 90-degree motion transfer applications.</p>
          <a
            class="download-button"
            href="manuals/4.pdf"
            download="Gear-A_Bevel_Gears_Manual.pdf"
            aria-label="Download Gear-A manual">
            Download Manual
          </a>
        </div>
        <div class="content-card">
          <h3>Gear-B Manual</h3>
          <p>Variable speed gear system manual covering dynamic load distribution, torque variation, and adaptive transmission concepts.</p>
          <a
            class="download-button"
            href="manuals/5.pdf"
            download="Gear-B_Variable_Speed_Manual.pdf"
            aria-label="Download Gear-B manual">
            Download Manual
          </a>
        </div>
        <div class="content-card">
          <h3>Gear-C Manual</h3>
          <p>Worm gear system comprehensive guide including self-locking mechanisms, torque multiplication, and precision control applications.</p>
          <a
            class="download-button"
            href="manuals/6.pdf"
            download="Gear-C_Worm_Gears_Manual.pdf"
            aria-label="Download Gear-C manual">
            Download Manual
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Models Screen -->
  <section id="modelsScreen" class="modal-screen" role="main" aria-labelledby="models-title">
    <div class="modal-header">
      <button class="modal-close-button" id="closeModelsBtn" aria-label="Close models screen">← Back</button>
      <div class="modal-title" id="models-title">3D Models</div>
      <div class="modal-subtitle">Download and explore the 3D models used in AR experiences</div>
    </div>
    <div class="modal-content">
      <div class="content-grid">
        <div class="content-card">
          <h3>Cam-A 3D Model</h3>
          <p>High-resolution STL model of the cam mechanism. Compatible with 3D printers and CAD software for further analysis and modification.</p>
          <button class="download-button" onclick="downloadModel('1')" aria-label="Download Cam-A 3D model">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Cam-C 3D Model</h3>
          <p>Geneva wheel mechanism 3D model including drive wheel and indexed output wheel. Perfect for educational demonstrations and prototyping.</p>
          <button class="download-button" onclick="downloadModel('2')" aria-label="Download Cam-C 3D model">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Crank 3D Model</h3>
          <p>Complete crank mechanism model with connecting rod and slider components. Ideal for studying reciprocating motion systems.</p>
          <button class="download-button" onclick="downloadModel('3')" aria-label="Download Crank 3D model">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Gear-A 3D Model</h3>
          <p>Precision bevel gear set model demonstrating 90-degree power transmission. Suitable for mechanical engineering education and analysis.</p>
          <button class="download-button" onclick="downloadModel('4')" aria-label="Download Gear-A 3D model">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Gear-B 3D Model</h3>
          <p>Variable speed gear system model showcasing dynamic torque distribution and non-uniform motion characteristics.</p>
          <button class="download-button" onclick="downloadModel('5')" aria-label="Download Gear-B 3D model">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Gear-C 3D Model</h3>
          <p>Worm gear assembly model featuring self-locking mechanism and high torque multiplication ratio components.</p>
          <button class="download-button" onclick="downloadModel('6')" aria-label="Download Gear-C 3D model">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Base Platform Model</h3>
          <p>Universal base platform for mounting and testing all mechanical kits. Includes standardized mounting points and measurement references for educational experiments.</p>
          <button class="download-button" onclick="downloadModel('7')" aria-label="Download Base Platform 3D model">Download STL</button>
        </div>
      </div>
    </div>
  </section>

  <!-- AR Screen -->
  <section id="arScreen">
    <!-- AR Initial Overlay -->
    <div class="ar-initial-overlay" id="arInitialOverlay">
      <div class="ar-initial-content">
        <h3>AR Instructions</h3>
        
        <div class="ar-instructions-grid">
          <div class="ar-instruction-item">
            <h4>Setup</h4>
            <p>Hold device steady. Point camera at ArUco marker (black/white square pattern). Keep marker flat and fully visible.</p>
          </div>
        </div>
        
        <button class="ar-start-button" id="arStartButton">Start Camera</button>
      </div>
    </div>

    <!-- AR Background to cover black void -->
    <div class="ar-background"></div>
    
    <div class="ar-header">
      <p><strong>Instructions:</strong> Point your camera at a kit marker to see the 3D demonstration</p>
    </div>
    <button class="ar-back-button" id="backHomeBtn">← Home</button>
    <button class="ar-help-button" id="arHelpBtn">Help</button>

    <!-- Left panel for additional coverage -->
    <div class="ar-left-panel"></div>

    <div class="ar-container">
      <video id="video" width="320" height="240" autoplay playsinline muted></video>
      <canvas id="canvas" width="320" height="240"></canvas>
      <div id="threeContainer"></div>
    </div>

    <div class="ar-sidebar">
      <h3>Kit Information</h3>
      <div class="ar-kit-info">
        <div class="ar-kit-name" id="arKitName">No kits detected</div>
        <div class="ar-kit-desc" id="arKitDesc">Point your camera at a marker to see kit information</div>
      </div>
      <button class="debug-button" id="debugSideBtn">Debug View</button>
    </div>

    <!-- AR Instructions Overlay -->
    <div class="ar-instructions-overlay" id="arInstructionsOverlay">
      <div class="ar-instructions-content">
        <div class="ar-instructions-header">
          <h3>AR Instructions</h3>
          <button class="ar-instructions-close" id="arInstructionsClose">Close</button>
        </div>
        
        <div class="ar-instructions-section">
          <h4>How to Use</h4>
          <ul>
            <li>Allow camera access when prompted</li>
            <li>Point your camera at a kit marker (ArUco marker)</li>
            <li>Keep the marker flat and fully visible</li>
            <li>Move the marker to see the 3D model from different angles</li>
          </ul>
        </div>

        <div class="ar-instructions-section">
          <h4>Available Kits</h4>
          <p><strong>Cam-A:</strong> Rotational to linear motion</p>
          <p><strong>Cam-C:</strong> Intermittent motion (Geneva wheel)</p>
          <p><strong>Crank:</strong> Reciprocating motion</p>
          <p><strong>Gear-A:</strong> Bevel gears (90° transmission)</p>
          <p><strong>Gear-B:</strong> Variable speed gears</p>
          <p><strong>Gear-C:</strong> Worm gear systems</p>
        </div>

        <div class="ar-instructions-section">
          <h4>Troubleshooting</h4>
          <ul>
            <li>Ensure good lighting conditions</li>
            <li>Keep markers flat and steady</li>
            <li>Try adjusting distance to marker</li>
            <li>Use Debug view to check marker detection</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Debug overlay -->
    <div class="debug-overlay" id="debugOverlay">
      <div class="debug-overlay-header">
        <h3>Debug Information</h3>
        <button class="debug-close" onclick="toggleDebugOverlay()">Close</button>
      </div>
      <div class="marker-info" id="markerInfo">No debug information available</div>
      <div class="debug-canvas-container">
        <canvas id="debugCanvas" width="320" height="240"></canvas>
      </div>
    </div>
  </section>

  <!-- AI Screen - Horizontal Card Layout -->
  <section id="aiScreen" class="modal-screen" role="main" aria-labelledby="ai-title">
<header class="ai-header">
    <button class="ai-close-button" onclick="closeAI()">← Back</button>
    <h1 class="ai-header-title">AI Assistant</h1>
    <p class="ai-header-subtitle">Create unique AR scenarios to explore different mechanical systems</p>
  </header>

  <!-- Main Container -->
  <div class="ai-main-container" id="aiMainContainer">
    
    <!-- Card 1 - 3D Models -->
    <div class="ai-card-container">
      <div class="ai-horizontal-card">
        <div class="card-left-side">
          <h2 class="card-title">3D Models</h2>
          <p class="card-subtitle">Select marine-themed 3D models for AR visualization</p>
          
          <div class="custom-dropdown">
            <button class="dropdown-trigger" onclick="toggleDropdown('models')">
              <span id="modelsSelected">Select Model</span>
              <span class="dropdown-arrow">▼</span>
            </button>
            <div class="dropdown-menu" id="modelsDropdown">
              <div class="dropdown-option" onclick="selectOption('models', 'String Ray', 'string-ray.png')">String Ray</div>
              <div class="dropdown-option" onclick="selectOption('models', 'Fish', 'fish.png')">Fish</div>
              <div class="dropdown-option" onclick="selectOption('models', 'Dolphin', 'dolphin.png')">Dolphin</div>
              <div class="dropdown-option" onclick="selectOption('models', 'Jellyfish', 'jellyfish.png')">Jellyfish</div>
              <div class="dropdown-option" onclick="selectOption('models', 'Octopus', 'octopus.png')">Octopus</div>
              <div class="dropdown-option" onclick="selectOption('models', 'Sea Turtle', 'sea-turtle.png')">Sea Turtle</div>
            </div>
          </div>
          
          <button class="help-button" onclick="showHelp('models')" title="Help with 3D Models">?</button>
        </div>
        
        <div class="card-right-side">
          <div class="card-image-container">
            <div class="image-placeholder" id="modelsPlaceholder">?</div>
            <img class="card-image" id="modelsImage" style="display: none;" alt="Selected 3D Model">
          </div>
        </div>
      </div>
    </div>

    <!-- Card 2 - Kit 1 -->
    <div class="ai-card-container">
      <div class="ai-horizontal-card">
        <div class="card-left-side">
          <h2 class="card-title">Kit 1</h2>
          <p class="card-subtitle">Choose the first mechanical kit for your scenario</p>
          
          <div class="custom-dropdown">
            <button class="dropdown-trigger" onclick="toggleDropdown('kit1')">
              <span id="kit1Selected">Select Kit 1</span>
              <span class="dropdown-arrow">▼</span>
            </button>
            <div class="dropdown-menu" id="kit1Dropdown">
              <div class="dropdown-option" onclick="selectOption('kit1', 'Cam-A Model', 'kit1.png')">Cam-A Model</div>
              <div class="dropdown-option" onclick="selectOption('kit1', 'Cam-C Model', 'kit2.png')">Cam-C Model</div>
              <div class="dropdown-option" onclick="selectOption('kit1', 'Crank Model', 'kit3.png')">Crank Model</div>
              <div class="dropdown-option" onclick="selectOption('kit1', 'Gear-A Model', 'kit4.png')">Gear-A Model</div>
              <div class="dropdown-option" onclick="selectOption('kit1', 'Gear-B Model', 'kit5.png')">Gear-B Model</div>
              <div class="dropdown-option" onclick="selectOption('kit1', 'Gear-C Model', 'kit6.png')">Gear-C Model</div>
            </div>
          </div>
          
          <button class="help-button" onclick="showHelp('kit1')" title="Help with Kit 1">?</button>
        </div>
        
        <div class="card-right-side">
          <div class="card-image-container">
            <div class="image-placeholder" id="kit1Placeholder">?</div>
            <img class="card-image" id="kit1Image" style="display: none;" alt="Selected Kit 1">
          </div>
        </div>
      </div>
    </div>

    <!-- Card 3 - Kit 2 -->
    <div class="ai-card-container">
      <div class="ai-horizontal-card">
        <div class="card-left-side">
          <h2 class="card-title">Kit 2</h2>
          <p class="card-subtitle">Choose the second mechanical kit for your scenario</p>
          
          <div class="custom-dropdown">
            <button class="dropdown-trigger" onclick="toggleDropdown('kit2')">
              <span id="kit2Selected">Select Kit 2</span>
              <span class="dropdown-arrow">▼</span>
            </button>
            <div class="dropdown-menu" id="kit2Dropdown">
              <div class="dropdown-option" onclick="selectOption('kit2', 'Cam-A Model', 'kit1.png')">Cam-A Model</div>
              <div class="dropdown-option" onclick="selectOption('kit2', 'Cam-C Model', 'kit2.png')">Cam-C Model</div>
              <div class="dropdown-option" onclick="selectOption('kit2', 'Crank Model', 'kit3.png')">Crank Model</div>
              <div class="dropdown-option" onclick="selectOption('kit2', 'Gear-A Model', 'kit4.png')">Gear-A Model</div>
              <div class="dropdown-option" onclick="selectOption('kit2', 'Gear-B Model', 'kit5.png')">Gear-B Model</div>
              <div class="dropdown-option" onclick="selectOption('kit2', 'Gear-C Model', 'kit6.png')">Gear-C Model</div>
            </div>
          </div>
          
          <button class="help-button" onclick="showHelp('kit2')" title="Help with Kit 2">?</button>
        </div>
        
        <div class="card-right-side">
          <div class="card-image-container">
            <div class="image-placeholder" id="kit2Placeholder">?</div>
            <img class="card-image" id="kit2Image" style="display: none;" alt="Selected Kit 2">
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Scenario Button -->
  <div class="scenario-button-container">
    <button class="scenario-button" onclick="openScenario()">View Scenario</button>
  </div>

  <!-- Scenario Popup -->
  <div class="scenario-popup" id="scenarioPopup">
    <div class="scenario-content">
      <button class="scenario-close" onclick="closeScenario()">×</button>
      <h2 class="scenario-title">Generated Scenario</h2>
      <div class="scenario-text" id="scenarioText">
        Welcome to AutomatAR AI Assistant! Select options from the cards above to create your custom mechanical engineering scenario. Each selection will provide detailed information about the components, assembly instructions, and educational objectives.
      </div>
    </div>
  </div>
  </section>

  <!-- PDF Viewer Modal -->
  <div id="pdfViewerModal" class="pdf-viewer-modal" role="dialog" aria-labelledby="pdf-viewer-title" aria-modal="true">
    <div class="pdf-viewer-header">
      <div class="pdf-viewer-title" id="pdf-viewer-title">Manual Viewer</div>
      <button class="pdf-viewer-close" id="closePdfViewer" aria-label="Close PDF viewer">← Close</button>
    </div>
    <div class="pdf-viewer">
      <iframe id="pdfFrame" src="" title="PDF Viewer" aria-label="PDF document viewer"></iframe>
      <div class="pdf-fallback" id="pdfFallback">
        <h3>PDF Viewer Not Available</h3>
        <p>Your browser doesn't support embedded PDF viewing.</p>
        <a href="" id="pdfDownloadLink" class="pdf-download-link" target="_blank" rel="noopener" aria-label="Open PDF in new tab">Open PDF in New Tab</a>
      </div>
    </div>
  </div>

  <!-- Create Screen -->
  <section id="createScreen" class="modal-screen" role="main" aria-labelledby="create-title">
    <div class="modal-header">
      <!-- ① Back on the left -->
      <button class="modal-close-button" id="closeCreateBtn">← Back</button>
  
      <!-- ② Title/Subtitle in the very center -->
      <div class="modal-header-center">
        <div class="modal-title" id="create-title">
          Create Your Own AR Models
        </div>
        <div class="modal-subtitle">
          Create your own unique AR models
        </div>
      </div>
    </div>
    
    <div class="modal-content">
      
      <!-- Camera Section -->
      <div class="create-section">
        <h3>Capture Animation Grid</h3>
        <div class="create-status" id="createStatus">Starting camera...</div>
        
        <div class="create-camera-container">
          <div class="create-camera-box">
            <video id="createVideo" autoplay muted playsinline></video>
           <div class="create-grid">
        <div class="create-cell"></div><div class="create-cell"></div>
        <div class="create-cell "></div><div class="create-cell create-golden"></div>
        <div class="create-cell create-golden"></div><div class="create-cell create-golden"></div>
      </div>
          </div>
          
          <div class="create-controls">
            <button id="createCapture" class="create-capture-btn" disabled>
              Capture Assembly Step
            </button>
            <button id="createClear" class="create-clear-btn" style="display: none;">
              Clear All Frames
            </button>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div class="create-section" id="createResultsSection" style="display: none;">
        <h3>Capture Animation Grids</h3>
        <div class="create-instructions">
          <p> Individual frames captured from the golden grid area</p>
          <p> Click any frame to download, or use the animation below</p>
        </div>
        <div class="create-results" id="createResults"></div>
      </div>

      <!-- Animation Section -->
      <div class="create-section" id="createAnimSection" style="display: none;">
        <h3>Assembly Animation</h3>
        <div class="create-animation-container">
          <div class="create-animation-box">
            <img id="createAnimFrame" src="" alt="Assembly animation frame">
            <div class="create-animation-overlay" id="createAnimOverlay">
              <span>No animation yet - capture some steps above!</span>
            </div>
          </div>
          <div class="create-animation-controls">
            <button id="createPlayPause" disabled>▶ Play</button>
            <button id="createResetAnim" disabled>⏹ Reset</button>
            <label>
              Speed: <input type="range" id="createSpeedSlider" min="200" max="2000" value="500" disabled> 
              <span id="createSpeedDisplay">500ms</span>
            </label>
          </div>
          
        </div>
        <button
        class="header-ar-button"
        type="button"
        aria-label="Open augmented reality experience"
        onclick="document.getElementById('openARBtn').click()">
        Open AR
      </button>
         
      </div>

     </div>

    </div>
  </section>

  <!-- JavaScript Files -->
  <script src="app.js"></script>

  <script>
      // Global state
      let selectedOptions = {
        models: { name: null, image: null },
        kit1: { name: null, image: null },
        kit2: { name: null, image: null }
      };

      // Scenario data
      const scenarioData = {
        models: {
          'String Ray': 'String Ray 3D Model: Graceful marine creature showcasing fluid motion dynamics. This model demonstrates hydrodynamic principles and streamlined design found in nature.',
          'Fish': 'Fish 3D Model: Classic aquatic form demonstrating efficient swimming mechanics. Perfect for studying biomechanics and natural propulsion systems.',
          'Dolphin': 'Dolphin 3D Model: Intelligent marine mammal model showcasing advanced hydrodynamics. Demonstrates echolocation systems and efficient underwater locomotion.',
          'Jellyfish': 'Jellyfish 3D Model: Unique cnidarian form showing pulsatile propulsion. Illustrates soft-body mechanics and efficient underwater movement.',
          'Octopus': 'Octopus 3D Model: Complex cephalopod demonstrating jet propulsion and flexible movement. Shows advanced neural control and adaptive mechanics.',
          'Sea Turtle': 'Sea Turtle 3D Model: Ancient marine reptile showcasing efficient swimming with limb propulsion. Demonstrates long-distance migration mechanics.'
        },
        kits: {
          'Cam-A Model': 'Cam-A Kit: Learn rotational motion conversion through hands-on assembly. Includes cam disc, follower, base plate, and mounting hardware for studying motion patterns.',
          'Cam-C Model': 'Cam-C Kit: Explore intermittent motion with Geneva wheel mechanism. Features drive wheel with pin, Geneva wheel with slots, and timing guides.',
          'Crank Model': 'Crank Kit: Master reciprocating motion mechanics. Includes crank arm, connecting rod, slider mechanism, and guide rails for motion study.',
          'Gear-A Model': 'Gear-A Kit: Understand perpendicular power transmission with bevel gears. Contains matched bevel gear pair and right-angle mounting frame.',
          'Gear-B Model': 'Gear-B Kit: Explore variable speed transmission systems. Features non-circular gear profiles and adjustable mounting for torque study.',
          'Gear-C Model': 'Gear-C Kit: Experience worm gear systems and self-locking properties. Includes precision worm screw and worm wheel assembly.'
        }
      };

      // Initialize page
      document.addEventListener('DOMContentLoaded', function() {
        initializeAnimations();
        setupScrollAnimations();
      });

      // Initialize Apple-style animations
      function initializeAnimations() {
        setTimeout(() => {
          const cards = document.querySelectorAll('.ai-card-container');
          cards.forEach((card, index) => {
            setTimeout(() => {
              card.classList.add('animate-in');
            }, index * 200);
          });
        }, 300);
      }

      // Setup scroll animations
      function setupScrollAnimations() {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('fade-in');
            }
          });
        }, { threshold: 0.1 });

        document.querySelectorAll('.ai-card-container').forEach(card => {
          observer.observe(card);
        });
      }

      // Toggle dropdown
      function toggleDropdown(type) {
        const dropdown = document.getElementById(type + 'Dropdown');
        const trigger  = dropdown.previousElementSibling;
        const card     = trigger.closest('.ai-card-container');

        // if already open → close it
        if (dropdown.classList.contains('open')) {
          dropdown.classList.remove('open');
          trigger.classList.remove('active');
          card.classList.remove('dropdown-open');
          return;
        }

        // otherwise close all then open this one
        closeAllDropdowns();
        dropdown.classList.add('open');
        trigger.classList.add('active');
        card.classList.add('dropdown-open');
      }

      function closeAllDropdowns() {
        document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('open'));
        document.querySelectorAll('.dropdown-trigger').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.ai-card-container').forEach(c => c.classList.remove('dropdown-open'));
      }

      // Select option
      function selectOption(type, name, imagePath) {
        // Update selected text
        document.getElementById(type + 'Selected').textContent = name;
        
        // Update image
        updateImage(type, imagePath);
        
        // Store selection
        selectedOptions[type] = { name, image: imagePath };
        
        // Update selected state
        const dropdown = document.getElementById(type + 'Dropdown');
        dropdown.querySelectorAll('.dropdown-option').forEach(opt => {
          opt.classList.remove('selected');
        });
        event.target.classList.add('selected');
        
        // Close dropdown
        closeAllDropdowns();
        
        // Add animation feedback
        const card = event.target.closest('.ai-horizontal-card');
        card.style.transform = 'translateY(-8px) scale(1.02)';
        setTimeout(() => {
          card.style.transform = '';
        }, 300);
        
        // Update scenario if popup is open
        if (document.getElementById('scenarioPopup').classList.contains('open')) {
          updateScenarioText();
        }
      }

      // Update image
      function updateImage(type, imagePath) {
        const placeholder = document.getElementById(type + 'Placeholder');
        const image = document.getElementById(type + 'Image');
        
        // Show loading state
        placeholder.style.opacity = '0.5';
        
        // Set image source
        image.src = `images/${imagePath}`;
        image.onload = function() {
          // Hide placeholder and show image
          placeholder.style.display = 'none';
          image.style.display = 'block';
          image.classList.add('loaded', 'scale-in');
          
          // Reset loading state
          placeholder.style.opacity = '1';
        };
        
        // Handle error
        image.onerror = function() {
          console.warn(`Failed to load image: ${imagePath}`);
          placeholder.style.opacity = '1';
          showNotification(`Failed to load image: ${imagePath}`, 'error');
        };
      }

      // Show help
      function showHelp(type) {
        let helpText = '';
        switch(type) {
          case 'models':
            helpText = '3D Models: Select marine-themed models to visualize in AR. Each model demonstrates unique movement and design principles from nature.';
            break;
          case 'kit1':
            helpText = 'Kit 1: Choose the first mechanical system for your scenario. Each kit teaches different motion conversion principles.';
            break;
          case 'kit2':
            helpText = 'Kit 2: Select the second mechanical system to combine with Kit 1. Create complex multi-system scenarios.';
            break;
        }
        showNotification(helpText, 'info');
      }

      // Open scenario popup
      function openScenario() {
        updateScenarioText();
        document.getElementById('scenarioPopup').classList.add('open');
      }

      // Close scenario popup
      function closeScenario() {
        document.getElementById('scenarioPopup').classList.remove('open');
      }

      // Update scenario text
      function updateScenarioText() {
        let content = '';
        let hasSelections = false;
        
        // Check for model selection
        if (selectedOptions.models.name) {
          content += '🎯 **3D MODEL SELECTED:**\n' + scenarioData.models[selectedOptions.models.name] + '\n\n';
          hasSelections = true;
        }
        
        // Check for kit1 selection
        if (selectedOptions.kit1.name) {
          content += '⚙️ **KIT 1 SELECTED:**\n' + scenarioData.kits[selectedOptions.kit1.name] + '\n\n';
          hasSelections = true;
        }
        
        // Check for kit2 selection
        if (selectedOptions.kit2.name) {
          content += '🔧 **KIT 2 SELECTED:**\n' + scenarioData.kits[selectedOptions.kit2.name] + '\n\n';
          hasSelections = true;
        }
        
        if (hasSelections) {
          content += '✨ **SCENARIO SUMMARY:**\nCombine these elements to create an engaging AR learning experience. The marine model provides visual appeal while the mechanical kits demonstrate engineering principles. Use AR markers to activate each component and explore their interactions.';
        } else {
          content = 'Welcome to AutomatAR AI Assistant! Select options from the cards above to create your custom mechanical engineering scenario.\n\nEach selection will provide detailed information about the components, assembly instructions, and educational objectives.\n\nClick on any dropdown menu to begin exploring our mechanical engineering resources.';
        }
        
        document.getElementById('scenarioText').textContent = content;
      }

      // Show notification
      function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: ${type === 'error' ? '#f44336' : type === 'info' ? '#2196F3' : '#4CAF50'};
          color: white;
          padding: 1rem 1.5rem;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          z-index: 10000;
          font-weight: 600;
          max-width: 300px;
          transform: translateX(100%);
          transition: transform 0.3s ease;
        `;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.transform = 'translateX(0)';
        }, 100);
        
        setTimeout(() => {
          notification.style.transform = 'translateX(100%)';
          setTimeout(() => {
            if (notification.parentNode) {
              document.body.removeChild(notification);
            }
          }, 300);
        }, 4000);
      }

      // Close AI (placeholder function)
      function closeAI() {
        if (window.showHomeScreen) {
          window.showHomeScreen();
        } else {
          console.log('Closing AI Assistant');
        }
      }

      // Close dropdowns when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.custom-dropdown')) {
          closeAllDropdowns();
        }
      });

      // Close scenario popup when clicking outside
      document.getElementById('scenarioPopup').addEventListener('click', function(e) {
        if (e.target === this) {
          closeScenario();
        }
      });

      // Handle escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeAllDropdowns();
          closeScenario();
        }
      });
    </script>
    <!-- Begin AI Integration Snippet -->
    <script id="ai-script" data-openai-key="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">
      (function(){
        // ── Grab API key from data attribute ───────────────────────────────────────
        const API_KEY = document
          .getElementById('ai-script')
          .dataset.openaiKey
          .trim();
        if (!API_KEY) {
          console.error('Missing OpenAI API key!');
        }
      
        // ── 1) Debounce utility ─────────────────────────────────────────────────────
        function debounce(fn, delay) {
          let timer;
          return function(...args) {
            clearTimeout(timer);
            timer = setTimeout(() => fn.apply(this, args), delay);
          };
        }
      
        // ── 2) Answer‐section helpers ────────────────────────────────────────────────
        function hideAnswerSection() {
          const sec = document.getElementById('answerSection');
          if (sec) {
            sec.style.display = 'none';
            sec.textContent  = '';
          }
        }
        function showAnswerButton() {
          const btn = document.getElementById('showAnswerBtn');
          if (btn) btn.style.display = 'block';
        }
      
        // ── 3) OpenAI integration with retry on 429 ─────────────────────────────────
        class OpenAIAITester {
          constructor() {
            this.currentAnswer      = '';
            this.currentExplanation = '';
          }
      
          async generateScenario(seaModel, kit1, kit2) {
            const scenario = this.buildScenario(seaModel, kit1, kit2);
            const prompt = `Write a 1–2 sentence mechanical engineering explanation (under 30 words) for why "${scenario.winner}" outperforms "${scenario.loser}" in terms of ${scenario.focus}, focusing only on mechanical principles.`;
      
            const maxRetries = 3;
            let attempt = 0, resp;
      
            while (attempt < maxRetries) {
              resp = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${API_KEY}`
                },
                body: JSON.stringify({
                  model: 'gpt-3.5-turbo',
                  messages: [
                    { role: 'system', content: 'You are an expert mechanical engineering tutor.' },
                    { role: 'user',   content: prompt }
                  ],
                  max_tokens: 60,
                  temperature: 0.3
                })
              });
      
              if (resp.status !== 429) break;
              // back off
              const retryAfter = parseInt(resp.headers.get('Retry-After') || '1', 10);
              await new Promise(r => setTimeout(r, (retryAfter + 1) * 1000));
              attempt++;
            }
      
            if (!resp.ok) {
              console.error('OpenAI error', resp.status);
              this.currentAnswer      = scenario.winner;
              this.currentExplanation = `${scenario.winner} mechanisms provide ${scenario.reason}, making them more effective than ${scenario.loser}.`;
            } else {
              const data = await resp.json();
              this.currentAnswer      = scenario.winner;
              this.currentExplanation = data.choices[0].message.content.trim();
            }
      
            return (
              `🎯 **Objective:** ${scenario.objective}\n\n` +
              `🔧 **Mechanisms:** ${kit1} vs. ${kit2}\n\n` +
              `💬 **Prompt:** "${scenario.prompt}"`
            );
          }
      
          revealAnswer() {
            return `**Answer:** ${this.currentAnswer}\n**Explanation:** ${this.currentExplanation}`;
          }
      
          buildScenario(seaModel, kit1, kit2) {
            const mechPower = { 'Worm Gear':5, 'Crank':4, 'Bevel Gear':3, 'Geneva':2, 'Cam':1 };
            const clean = name =>
              name.replace(/[-\s]?Model/, '')
                  .replace(/Cam-([A-C])/,'Cam')
                  .replace(/Gear-([A-C])/,'$1 Gear');
            const k1 = clean(kit1), k2 = clean(kit2);
            const p1 = mechPower[k1]||1, p2 = mechPower[k2]||1;
            const winner = p1 >= p2 ? k1 : k2,
                  loser  = winner === k1 ? k2 : k1;
      
            const templates = [
              { objective:'Compare speed of motion',       prompt:`Which mechanism swims faster for the ${seaModel}? Why mechanically?`,    focus:'speed',      reason:'continuous motion' },
              { objective:'Compare force transmission',    prompt:`Which mechanism applies force more efficiently to the ${seaModel}?`,     focus:'torque',     reason:'higher torque' },
              { objective:'Compare precision and control', prompt:`Which mechanism offers better control for the ${seaModel}?`,              focus:'control',    reason:'consistent motion' },
              { objective:'Evaluate energy efficiency',    prompt:`Which mechanism uses less energy if the ${seaModel} swims for hours?`,    focus:'efficiency', reason:'optimal transfer' },
              { objective:'Test under load',               prompt:`Which mechanism pushes through resistance best for the ${seaModel}?`,     focus:'load',       reason:'stronger output' }
            ];
            const pick = templates[Math.floor(Math.random()*templates.length)];
      
            return {
              objective: pick.objective,
              prompt:   pick.prompt,
              winner,
              loser,
              focus:    pick.focus,
              reason:   pick.reason
            };
          }
        }
      
        // ── 4) Instantiate & define generation/show functions ────────────────────────
        const aiTester = new OpenAIAITester();
      
        async function tryAutoGenerate() {
          const sea = selectedOptions.models?.name;
          const k1  = selectedOptions.kit1?.name;
          const k2  = selectedOptions.kit2?.name;
          if (!sea || !k1 || !k2) return;
      
          document.getElementById('scenarioText').textContent = '🤖 Generating educational scenario…';
          hideAnswerSection();
          showAnswerButton();
      
          try {
            const text = await aiTester.generateScenario(sea, k1, k2);
            document.getElementById('scenarioText').textContent = text;
          } catch (e) {
            console.error(e);
            document.getElementById('scenarioText').textContent = 'Error generating scenario.';
          }
        }
      
        function showAnswer() {
          const sec = document.getElementById('answerSection');
          sec.textContent = aiTester.revealAnswer();
          sec.style.display = 'block';
          document.getElementById('showAnswerBtn').style.display = 'none';
        }
      
        // ── 5) Hook dropdowns with debounce ─────────────────────────────────────────
        (function(){
          const originalSelect = window.selectOption;
          const debouncedTry   = debounce(tryAutoGenerate, 800);
          window.selectOption = function(type, name, imagePath) {
            originalSelect(type, name, imagePath);
            debouncedTry();
          };
        })();
      
        // ── 6) Wire up the “Show Answer” button ─────────────────────────────────────
        document.addEventListener('DOMContentLoaded', () => {
          const btn = document.getElementById('showAnswerBtn');
          if (btn) btn.addEventListener('click', showAnswer);
        });
      })();
      </script>
      
  
  <!-- Screen Reader Only Content -->
  <div class="sr-only" aria-live="polite" id="screen-reader-announcements"></div>

</body>
</html>
