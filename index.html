<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutomatAR</title>

  <!-- External Libraries -->
  <script src="libs/Three.js"></script>
  <script src="libs/STLLoader.js"></script>
  <script src="src/svd.js"></script>
  <script src="src/posit1.js"></script>
  <script src="src/cv.js"></script>
  <script src="src/aruco.js"></script>
  <script src="src/atf.js"></script>
  <script src="src/multiS.js"></script>
  <script src="src/optic.js"></script>

  <!-- External CSS and JS -->
  <link rel="stylesheet" href="styles.css">
  <script src="app.js"></script>
</head>
<body>
  <!-- Parallax Background -->
  <div class="parallax-bg"></div>

  <!-- Header -->
  <div class="header-bar" id="mainHeader" style="display: flex;">
    <div class="header-content">
      <div></div> <!-- Empty div for spacing -->
      <h1>AutomatAR</h1>
      <div class="header-buttons">
        <button class="header-button" id="manualsBtn">Manuals</button>
        <button class="header-ar-button" id="openARBtn">Open AR</button>
        <button class="header-button" id="modelsBtn">Models</button>
      </div>
    </div>
  </div>

  <!-- Home Screen -->
  <section id="homeScreen" style="display: block;">
    <!-- Intro -->
    <div class="intro-section">
      <div class="container">
        <h2>Welcome to AutomatAR</h2>
        <p>Explore mechanical engineering concepts through augmented reality. Point your camera at kit markers to see interactive 3D demonstrations of gears, cams, cranks, and other mechanical systems.</p>
      </div>
    </div>

    <!-- Cam-A Kit -->
    <div class="kit-section">
      <div class="kit-content">
        <div class="kit-text pre-assembly">
          <h3>Cam-A: Learn the details of rotational motion</h3>
          <p>Demonstrates how cams convert rotational motion into linear oscillatory motion using contoured surfaces to drive followers in precise, complex patterns.</p>
        </div>
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(0)">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit1.mp4" type="video/mp4">
            <div class="placeholder-img">Cam-A Kit Video</div>
          </video>
        </div>
      </div>
    </div>

    <!-- Cam-C Kit -->
    <div class="kit-section">
      <div class="kit-content reverse">
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(1)">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit2.mp4" type="video/mp4">
            <div class="placeholder-img">Cam-C Kit Video</div>
          </video>
        </div>
        <div class="kit-text pre-assembly">
          <h3>Cam-C: Get to know more about intermittent motion</h3>
          <p>Shows how a Geneva wheel mechanism creates precise, timed intermittent motion from continuous rotational input using pins and slots.</p>
        </div>
      </div>
    </div>

    <!-- Crank Kit -->
    <div class="kit-section">
      <div class="kit-content">
        <div class="kit-text pre-assembly">
          <h3>Crank: Understanding reciprocating motion</h3>
          <p>Illustrates how a rotating crank arm converts rotational motion into linear back-and-forth movement through connecting rods.</p>
        </div>
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(2)">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit3.mp4" type="video/mp4">
            <div class="placeholder-img">Crank Kit Video</div>
          </video>
        </div>
      </div>
    </div>

    <!-- Gear-A Kit -->
    <div class="kit-section">
      <div class="kit-content reverse">
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(3)">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit4.mp4" type="video/mp4">
            <div class="placeholder-img">Gear-A Kit Video</div>
          </video>
        </div>
        <div class="kit-text pre-assembly">
          <h3>Gear-A: Exploring perpendicular power transmission</h3>
          <p>Demonstrates how bevel gears with cone-shaped teeth transfer rotational motion between perpendicular shafts at 90-degree angles.</p>
        </div>
      </div>
    </div>

    <!-- Gear-B Kit -->
    <div class="kit-section">
      <div class="kit-content">
        <div class="kit-text pre-assembly">
          <h3>Gear-B: Variable speed and torque systems</h3>
          <p>Shows how gear alignment and shape create variable speed and torque output from constant input through dynamic load distribution.</p>
        </div>
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(4)">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit5.mp4" type="video/mp4">
            <div class="placeholder-img">Gear-B Kit Video</div>
          </video>
        </div>
      </div>
    </div>

    <!-- Gear-C Kit -->
    <div class="kit-section">
      <div class="kit-content reverse">
        <div class="kit-image pre-assembly parallax-element" onclick="showKitDetail(5)">
          <video class="kit-video" autoplay muted loop playsinline>
            <source src="images/kit6.mp4" type="video/mp4">
            <div class="placeholder-img">Gear-C Kit Video</div>
          </video>
        </div>
        <div class="kit-text pre-assembly">
          <h3>Gear-C: Mastering worm gear systems</h3>
          <p>Gear-C is a worm gear system that converts rotational motion while significantly reducing speed & increasing torque. A screw-like worm drives a worm wheel, transferring motion at 90°. This design offers high torque output & a self-locking feature, so it can't be back-driven. Used in elevators, conveyors, tuning mechanisms—anywhere controlled motion & torque multiplication are vital.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Kit Detail Screen -->
  <section id="kitDetailScreen">
    <div class="container">
      <div class="kit-detail">
        <div class="kit-detail-image">
          <video class="kit-detail-video" autoplay muted loop playsinline id="kitDetailVideo">
            <source src="images/camani.mp4" type="video/mp4">
            <div class="placeholder-img" id="kitDetailImg">Kit Video</div>
          </video>
        </div>
        <div class="kit-detail-text">
          <h2 id="kitDetailTitle">Kit Name</h2>
          <p id="kitDetailDesc">Kit description will appear here.</p>
          <button class="back-button" id="kitBackHomeBtn">Back to Home</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Manuals Screen -->
  <section id="manualsScreen" class="modal-screen">
    <div class="modal-header">
      <button class="modal-close-button" id="closeManualsBtn">← Back</button>
      <div class="modal-title">Instruction Manuals</div>
      <div class="modal-subtitle">Download comprehensive guides for each mechanical kit</div>
    </div>
    <div class="modal-content">
      <div class="content-grid">
        <div class="content-card">
          <h3>Cam-A Manual</h3>
          <p>Complete assembly instructions and theory guide for the Cam-A rotational motion kit. Includes part diagrams, assembly steps, and engineering principles.</p>
          <button class="download-button" onclick="openManual('1')">View Manual</button>
        </div>
        <div class="content-card">
          <h3>Cam-C Manual</h3>
          <p>Geneva wheel mechanism guide covering intermittent motion principles, assembly procedures, and practical applications in machinery.</p>
          <button class="download-button" onclick="openManual('2')">View Manual</button>
        </div>
        <div class="content-card">
          <h3>Crank Manual</h3>
          <p>Reciprocating motion system manual with detailed explanations of crank mechanisms, connecting rods, and motion conversion principles.</p>
          <button class="download-button" onclick="openManual('3')">View Manual</button>
        </div>
        <div class="content-card">
          <h3>Gear-A Manual</h3>
          <p>Bevel gear system guide explaining perpendicular power transmission, gear ratios, and 90-degree motion transfer applications.</p>
          <button class="download-button" onclick="openManual('4')">View Manual</button>
        </div>
        <div class="content-card">
          <h3>Gear-B Manual</h3>
          <p>Variable speed gear system manual covering dynamic load distribution, torque variation, and adaptive transmission concepts.</p>
          <button class="download-button" onclick="openManual('5')">View Manual</button>
        </div>
        <div class="content-card">
          <h3>Gear-C Manual</h3>
          <p>Worm gear system comprehensive guide including self-locking mechanisms, torque multiplication, and precision control applications.</p>
          <button class="download-button" onclick="openManual('6')">View Manual</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Models Screen -->
  <section id="modelsScreen" class="modal-screen">
    <div class="modal-header">
      <button class="modal-close-button" id="closeModelsBtn">← Back</button>
      <div class="modal-title">3D Models</div>
      <div class="modal-subtitle">Download and explore the 3D models used in AR experiences</div>
    </div>
    <div class="modal-content">
      <div class="content-grid">
        <div class="content-card">
          <h3>Cam-A 3D Model</h3>
          <p>High-resolution STL model of the cam mechanism. Compatible with 3D printers and CAD software for further analysis and modification.</p>
          <button class="download-button" onclick="downloadModel('cam a')">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Cam-C 3D Model</h3>
          <p>Geneva wheel mechanism 3D model including drive wheel and indexed output wheel. Perfect for educational demonstrations and prototyping.</p>
          <button class="download-button" onclick="downloadModel('CAM-C (geneva stop)')">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Crank 3D Model</h3>
          <p>Complete crank mechanism model with connecting rod and slider components. Ideal for studying reciprocating motion systems.</p>
          <button class="download-button" onclick="downloadModel('crank')">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Gear-A 3D Model</h3>
          <p>Precision bevel gear set model demonstrating 90-degree power transmission. Suitable for mechanical engineering education and analysis.</p>
          <button class="download-button" onclick="downloadModel('gear a')">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Gear-B 3D Model</h3>
          <p>Variable speed gear system model showcasing dynamic torque distribution and non-uniform motion characteristics.</p>
          <button class="download-button" onclick="downloadModel('gear b')">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Gear-C 3D Model</h3>
          <p>Worm gear assembly model featuring self-locking mechanism and high torque multiplication ratio components.</p>
          <button class="download-button" onclick="downloadModel('gear c')">Download STL</button>
        </div>
        <div class="content-card">
          <h3>Base Platform Model</h3>
          <p>Universal base platform for mounting and testing all mechanical kits. Includes standardized mounting points and measurement references for educational experiments.</p>
          <button class="download-button" onclick="downloadModel('base v7')">Download STL</button>
        </div>
      </div>
    </div>
  </section>

  <!-- PDF Viewer Modal -->
  <div id="pdfViewerModal" class="pdf-viewer-modal">
    <div class="pdf-viewer-header">
      <div class="pdf-viewer-title" id="pdfViewerTitle">Manual Viewer</div>
      <button class="pdf-viewer-close" id="closePdfViewer">← Close</button>
    </div>
    <div class="pdf-viewer">
      <iframe id="pdfFrame" src="" title="PDF Viewer"></iframe>
      <div class="pdf-fallback" id="pdfFallback" style="display: none;">
        <h3>PDF Viewer Not Available</h3>
        <p>Your browser doesn't support embedded PDF viewing.</p>
        <a href="" id="pdfDownloadLink" class="pdf-download-link" target="_blank">Open PDF in New Tab</a>
      </div>
    </div>
  </div>

  <!-- AR Screen -->
  <section id="arScreen">
    <!-- AR Initial Overlay -->
    <div class="ar-initial-overlay" id="arInitialOverlay">
      <div class="ar-initial-content">
        <h3>AR Instructions</h3>
        
        <div class="ar-instructions-grid">
          <div class="ar-instruction-item">
            <h4>Setup</h4>
            <p>Hold device steady. Point camera at ArUco marker (black/white square pattern). Keep marker flat and fully visible.</p>
          </div>
        </div>
        
        <button class="ar-start-button" id="arStartButton">Start Camera</button>
      </div>
    </div>

    <!-- AR Background to cover black void -->
    <div class="ar-background"></div>
    
    <div class="ar-header">
      <p><strong>Instructions:</strong> Point your camera at a kit marker to see the 3D demonstration</p>
    </div>
    <button class="ar-back-button" id="backHomeBtn">← Home</button>
    <button class="ar-help-button" id="arHelpBtn">Help</button>

    <!-- Left panel for additional coverage -->
    <div class="ar-left-panel"></div>

    <div class="ar-container">
      <video id="video" width="320" height="240" autoplay playsinline muted></video>
      <canvas id="canvas" width="320" height="240"></canvas>
      <div id="threeContainer"></div>
    </div>

    <div class="ar-sidebar">
      <h3>Kit Information</h3>
      <div class="ar-kit-info">
        <div class="ar-kit-name" id="arKitName">No kits detected</div>
        <div class="ar-kit-desc" id="arKitDesc">Point your camera at a marker to see kit information</div>
      </div>
      <button class="debug-button" id="debugSideBtn">Debug View</button>
    </div>

    <!-- AR Instructions Overlay -->
    <div class="ar-instructions-overlay" id="arInstructionsOverlay">
      <div class="ar-instructions-content">
        <div class="ar-instructions-header">
          <h3>AR Instructions</h3>
          <button class="ar-instructions-close" id="arInstructionsClose">Close</button>
        </div>
        
        <div class="ar-instructions-section">
          <h4>How to Use</h4>
          <ul>
            <li>Allow camera access when prompted</li>
            <li>Point your camera at a kit marker (ArUco marker)</li>
            <li>Keep the marker flat and fully visible</li>
            <li>Move the marker to see the 3D model from different angles</li>
          </ul>
        </div>

        <div class="ar-instructions-section">
          <h4>Available Kits</h4>
          <p><strong>Cam-A:</strong> Rotational to linear motion</p>
          <p><strong>Cam-C:</strong> Intermittent motion (Geneva wheel)</p>
          <p><strong>Crank:</strong> Reciprocating motion</p>
          <p><strong>Gear-A:</strong> Bevel gears (90° transmission)</p>
          <p><strong>Gear-B:</strong> Variable speed gears</p>
          <p><strong>Gear-C:</strong> Worm gear systems</p>
        </div>

        <div class="ar-instructions-section">
          <h4>Troubleshooting</h4>
          <ul>
            <li>Ensure good lighting conditions</li>
            <li>Keep markers flat and steady</li>
            <li>Try adjusting distance to marker</li>
            <li>Use Debug view to check marker detection</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Debug overlay -->
    <div class="debug-overlay" id="debugOverlay">
      <div class="debug-overlay-header">
        <h3>Debug Information</h3>
        <button class="debug-close" onclick="toggleDebugOverlay()">Close</button>
      </div>
      <div class="marker-info" id="markerInfo">No debug information available</div>
      <div class="debug-canvas-container">
        <canvas id="debugCanvas" width="320" height="240"></canvas>
      </div>
    </div>
  </section>
</body>
</html>

